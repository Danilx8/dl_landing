<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–ª–æ–∂–Ω–∞—è —Ñ–æ—Ä–º–∞</title>
    <link rel="stylesheet" href="app.css">
</head>
<body>
<div class="container">
    <img src="./files/logo.svg" alt="Ekzamka" class="logo">

    <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å —Å —à–∞–≥–∞–º–∏ (–¥–µ—Å–∫—Ç–æ–ø) -->
    <div class="steps-sidebar">
        <ul class="steps-list">
            <li class="step-item complete">
                <div class="step-number"></div>
                <div class="step-title">–£–∫–∞–∂–∏ —Ç–µ–º—É —Ä–∞–±–æ—Ç—ã</div>
            </li>
            <li class="step-item active">
                <div class="step-number">2</div>
                <div class="step-title">–°–æ–≥–ª–∞—Å—É–π —Ü–µ–ª–∏ –∏ –æ–±—ä—ë–º—ã</div>
            </li>
            <li class="step-item">
                <div class="step-number">3</div>
                <div class="step-title">–ü—Ä–æ–≤–µ—Ä—å —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ</div>
            </li>
            <li class="step-item">
                <div class="step-number">4</div>
                <div class="step-title">–£—Ç–≤–µ—Ä–¥–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∏</div>
            </li>
            <li class="step-item">
                <div class="step-number">5</div>
                <div class="step-title">–ü–æ–ª—É—á–∏ —Ä–∞–±–æ—Ç—É</div>
            </li>
            <li class="step-item">
                <div class="step-number">6</div>
                <div class="step-title">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ</div>
            </li>
        </ul>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <div class="main-content">
        <!-- –ú–æ–±–∏–ª—å–Ω—ã–µ —à–∞–≥–∏ —Å–≤–µ—Ä—Ö—É -->
        <div class="mobile-steps">
            <ul class="mobile-steps-list">
                <li class="mobile-step-item active">
                    <div class="mobile-step-number">1</div>
                    <div class="mobile-step-title">–õ–∏—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</div>
                </li>
                <li class="mobile-step-item">
                    <div class="mobile-step-number">2</div>
                    <div class="mobile-step-title">–ö–æ–Ω—Ç–∞–∫—Ç—ã</div>
                </li>
                <li class="mobile-step-item">
                    <div class="mobile-step-number">3</div>
                    <div class="mobile-step-title">–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ</div>
                </li>
                <li class="mobile-step-item">
                    <div class="mobile-step-number">4</div>
                    <div class="mobile-step-title">–†–∞–±–æ—Ç–∞</div>
                </li>
                <li class="mobile-step-item">
                    <div class="mobile-step-number">5</div>
                    <div class="mobile-step-title">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ</div>
                </li>
                <li class="mobile-step-item">
                    <div class="mobile-step-number">6</div>
                    <div class="mobile-step-title">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ</div>
                </li>
            </ul>
        </div>

        <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–æ—Ä–º—ã -->
        <div class="form-content">
            <div class="form-header">
                <div class="emoji-container">
                    üí¨
                </div>
                <h1 class="form-title">–õ–∏—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h1>
            </div>
            <div class="form-fields">
                <div class="input-container">
                    <h2 class="input-title">–í—ã–±–µ—Ä–∏ —Ç–∏–ø —Ä–∞–±–æ—Ç—ã</h2>
                    <div class="theme-grid" id="themeGrid">
                        <div class="theme-block">
                            <div class="theme-text">–ö—É—Ä—Å–æ–≤–∞—è —Ä–∞–±–æ—Ç–∞</div>
                        </div>
                        <div class="theme-block">
                            <div class="theme-text">–†–µ—Ñ–µ—Ä–∞—Ç</div>
                        </div>
                        <div class="theme-block">
                            <div class="theme-text">–≠—Å—Å–µ</div>
                        </div>
                        <div class="theme-block">
                            <div class="theme-text">–°–æ—á–∏–Ω–µ–Ω–∏–µ</div>
                        </div>
                        <div class="theme-block">
                            <div class="theme-text">–î–∏–ø–ª–æ–º–Ω–∞—è —Ä–∞–±–æ—Ç–∞</div>
                        </div>
                        <div class="theme-block">
                            <div class="theme-text">–î–æ–∫–ª–∞–¥</div>
                        </div>
                        <div class="theme-block">
                            <div class="theme-text">–ù–∞—É—á–Ω–∞—è —Å—Ç–∞—Ç—å—è</div>
                        </div>
                        <div class="theme-block">
                            <div class="theme-text">–û—Ç—á–µ—Ç –æ –ø—Ä–∞–∫—Ç–∏–∫–µ</div>
                        </div>
                        <div class="theme-block">
                            <div class="theme-text">–†–µ—Ü–µ–Ω–∑–∏—è</div>
                        </div>
                        <div class="theme-block">
                            <div class="theme-text">–ù–∞—É—á–Ω–æ-–∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è —Ä–∞–±–æ—Ç–∞</div>
                        </div>
                    </div>
                </div>
                <div class="input-container">
                    <h2 class="input-title">–í–≤–µ–¥–∏ —Ç–µ–º—É</h2>
                    <textarea class="input-text" name="Topic" cols="30" rows="10"
                              placeholder="–ö—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—è. –°–∫–≤–æ–∑–Ω–æ–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ"></textarea>
                </div>
                <div class="input-container">
                    <h2 class="input-title">–¶–µ–ª–∏ —Ä–∞–±–æ—Ç—ã</h2>
                    <button class="add-button" onclick="addNewItem('listContainer')">
                        ‚ûï –î–æ–±–∞–≤–∏—Ç—å —ç–ª–µ–º–µ–Ω—Ç
                    </button>
                    <div class="list-container" id="listContainer">
                        <div class="empty-state">
                            –°–ø–∏—Å–æ–∫ –ø—É—Å—Ç. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –≤—ã—à–µ, —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç.
                        </div>
                    </div>
                </div>
                <div class="input-container">
                    <h2 class="input-title">–û–±—ä—ë–º —Ä–∞–±–æ—Ç—ã</h2>
                    <div class="volume-block">
                        <div class="volume-input">
                            <button id="decrement">-</button>
                            <input type="number" id="textPages" value="10" min="1">
                            <button id="increment">+</button>
                        </div>
                        <div class="volume-component">
                            <div class="volume-bar" id="volumeBar">
                                <div class="section" style="width: 15.79%; background-color: #E7E7E9;">
                                    <span class="section-size">1</span>
                                </div>
                                <div class="section" style="width: 15.79%; background-color: #D4FBE6;">
                                    <span class="section-size">1</span>
                                </div>
                                <div class="section" style="width: 52.63%; background-color: #EFDFF7;">
                                    <span class="section-size">10</span>
                                </div>
                                <div class="section" style="width: 15.79%; background-color: #D3FAF8;">
                                    <span class="section-size">1</span>
                                </div>
                            </div>
                            <div class="volume-labels" id="volumeLabels">
                                <span class="section-label">–¢–∏—Ç—É–ª—å–Ω–∏–∫</span>
                                <span class="section-label">–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ</span>
                                <span class="section-label">–¢–µ–∫—Å—Ç —Ä–∞–±–æ—Ç—ã</span>
                                <span class="section-label">–õ–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="input-container">
                    <h2 class="input-title">–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã</h2>
                    <button class="add-button" onclick="addNewItem('topicsContainer')">‚ûï –î–æ–±–∞–≤–∏—Ç—å —ç–ª–µ–º–µ–Ω—Ç</button>
                    <div class="list-container" id="topicsContainer">
                        <div class="empty-state">–°–ø–∏—Å–æ–∫ –ø—É—Å—Ç. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –≤—ã—à–µ, —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç.
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ -->
    <div class="navigation-buttons">
        <button class="nav-button back">
            <svg class="nav-icon" width="18" height="18" viewBox="0 0 18 18" fill="none"
                 xmlns="http://www.w3.org/2000/svg">
                <path d="M14.25 9L3.75 9" stroke="#0F172A" stroke-width="1.5" stroke-linecap="round"
                      stroke-linejoin="round"/>
                <path d="M9 14.25L3.75 9L9 3.75" stroke="#0F172A" stroke-width="1.5" stroke-linecap="round"
                      stroke-linejoin="round"/>
            </svg>
            –ù–∞–∑–∞–¥
        </button>
        <button class="nav-button next">–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥
            <svg class="nav-icon" width="18" height="18" viewBox="0 0 18 18" fill="none"
                 xmlns="http://www.w3.org/2000/svg">
                <path d="M3.75 9H14.25" stroke="white" stroke-width="1.5" stroke-linecap="round"
                      stroke-linejoin="round"/>
                <path d="M9 3.75L14.25 9L9 14.25" stroke="white" stroke-width="1.5" stroke-linecap="round"
                      stroke-linejoin="round"/>
            </svg>
        </button>
    </div>

    <!-- –°–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–µ—Ç–∏ (–¥–µ—Å–∫—Ç–æ–ø) -->
    <div class="social-links">
        <a href="#" class="social-link" title="Profile page">
            <svg class="social-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                 viewBox="0 0 16 16">
                <path d="M3 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1zm5-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6"/>
            </svg>
            –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</a>
        <a href="#" class="social-link" title="Telegram"><?xml version="1.0" encoding="utf-8"?>
            <svg class="social-icon" width="800px" height="800px" viewBox="0 0 48 48" fill="none"
                 xmlns="http://www.w3.org/2000/svg">
                <path d="M41.4193 7.30899C41.4193 7.30899 45.3046 5.79399 44.9808 9.47328C44.8729 10.9883 43.9016 16.2908 43.1461 22.0262L40.5559 39.0159C40.5559 39.0159 40.3401 41.5048 38.3974 41.9377C36.4547 42.3705 33.5408 40.4227 33.0011 39.9898C32.5694 39.6652 24.9068 34.7955 22.2086 32.4148C21.4531 31.7655 20.5897 30.4669 22.3165 28.9519L33.6487 18.1305C34.9438 16.8319 36.2389 13.8019 30.8426 17.4812L15.7331 27.7616C15.7331 27.7616 14.0063 28.8437 10.7686 27.8698L3.75342 25.7055C3.75342 25.7055 1.16321 24.0823 5.58815 22.459C16.3807 17.3729 29.6555 12.1786 41.4193 7.30899Z"
                      fill="#000000"/>
            </svg>
            –ü–æ–¥–¥–µ—Ä–∂–∫–∞ 24/7</a>
    </div>

    <!-- –ö–Ω–æ–ø–∫–∞ –º–æ–±–∏–ª—å–Ω–æ–≥–æ –º–µ–Ω—é -->
    <button class="mobile-menu-toggle">‚ò∞</button>
</div>

<script>
    function isMobile() {
        return window.innerWidth <= 768;
    }

    function renderList(containerId) {
        const container = document.getElementById(containerId);
        const isTopics = containerId === 'topicsContainer';
        const itemList = items[containerId];

        if (itemList.length === 0) {
            container.innerHTML = '<div class="empty-state">–°–ø–∏—Å–æ–∫ –ø—É—Å—Ç. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –≤—ã—à–µ, —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç.</div>';
            return;
        }

        container.innerHTML = itemList.map((item, index) => `
        <div class="${isTopics ? 'topic-item' : 'list-item'}" data-index="${index}" draggable="${isTopics ? 'false' : 'true'}">
            <div class="item-content">
                <div class="item-number">${index + 1}</div>
                <div class="item-text" style="display: ${item.editing ? 'none' : 'flex'}" onclick="handleItemClick(${index}, '${containerId}')">${item.text || '–ü—É—Å—Ç–æ–π —ç–ª–µ–º–µ–Ω—Ç'}</div>
                <input
                    type="text"
                    class="item-input"
                    value="${item.text || ''}"
                    placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç..."
                    style="display: ${item.editing ? 'block' : 'none'}"
                    onblur="finishEditing(${index}, '${containerId}')"
                    onkeypress="handleKeyPress(event, ${index}, '${containerId}')"
                />
                <div class="item-controls" style="display: ${item.editing || isMobile() ? 'none' : 'flex'}">
                    ${isTopics ? `
                        <button class="control-button add-sub-button" onclick="event.stopPropagation(); addSubItem(${index}, '${containerId}')" title="–î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥—Ä–∞–∑–¥–µ–ª"></button>
                    ` : ''}
                    ${!isTopics ? `
                        <button class="control-button drag-button" onmousedown="startDrag(event, ${index}, '${containerId}')" title="–ü–µ—Ä–µ—Ç–∞—â–∏—Ç—å"></button>
                    ` : ''}
                    <button class="control-button delete-button" onclick="event.stopPropagation(); deleteItem(${index}, '${containerId}')" title="–£–¥–∞–ª–∏—Ç—å"></button>
                </div>
                ${item.editing ? `
                    <div class="item-controls">
                        <button class="control-button confirm-button" onclick="event.stopPropagation(); finishEditing(${index}, '${containerId}')" title="–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å"></button>
                        <button class="control-button cancel-button" onclick="event.stopPropagation(); cancelEditing(${index}, '${containerId}')" title="–û—Ç–º–µ–Ω–∏—Ç—å"></button>
                    </div>
                ` : ''}
            </div>
            ${isTopics && item.subItems ? `
                <div class="sub-items">
                    ${item.subItems.map((subItem, subIndex) => `
                        <div class="sub-item" data-index="${index}" data-sub-index="${subIndex}">
                            <div class="item-content">
                                <div class="item-number">${index + 1}.${subIndex + 1}</div>
                                <div class="item-text" style="display: ${subItem.editing ? 'none' : 'block'}" onclick="handleItemClick(${index}, '${containerId}', ${subIndex})">${subItem.text || '–ü—É—Å—Ç–æ–π –ø–æ–¥—Ä–∞–∑–¥–µ–ª'}</div>
                                <input
                                    type="text"
                                    class="item-input"
                                    value="${subItem.text || ''}"
                                    placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç..."
                                    style="display: ${subItem.editing ? 'block' : 'none'}"
                                    onblur="finishEditing(${index}, '${containerId}', ${subIndex})"
                                    onkeypress="handleKeyPress(event, ${index}, '${containerId}', ${subIndex})"
                                />
                                <div class="item-controls" style="display: ${subItem.editing || isMobile() ? 'none' : 'block'}">
                                    <button class="control-button delete-button" onclick="event.stopPropagation(); deleteItem(${index}, '${containerId}', ${subIndex})" title="–£–¥–∞–ª–∏—Ç—å"></button>
                                </div>
                                ${subItem.editing ? `
                                    <div class="item-controls">
                                        <button class="control-button confirm-button" onclick="event.stopPropagation(); finishEditing(${index}, '${containerId}', ${subIndex})" title="–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å"></button>
                                        <button class="control-button cancel-button" onclick="event.stopPropagation(); cancelEditing(${index}, '${containerId}', ${subIndex})" title="–û—Ç–º–µ–Ω–∏—Ç—å"></button>
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                    `).join('')}
                </div>
            ` : ''}
        </div>
    `).join('');

        const editingItems = itemList.map((item, index) => item.editing ? index : -1).filter(i => i !== -1);
        if (editingItems.length > 0) {
            setTimeout(() => {
                const input = container.querySelector(`[data-index="${editingItems[0]}"] .item-input`);
                if (input) input.focus();
            }, 100);
        }

        if (isTopics) {
            itemList.forEach((item, index) => {
                if (item.subItems) {
                    const editingSubItems = item.subItems.map((subItem, subIndex) => subItem.editing ? subIndex : -1).filter(i => i !== -1);
                    if (editingSubItems.length > 0) {
                        setTimeout(() => {
                            const input = container.querySelector(`[data-index="${index}"][data-sub-index="${editingSubItems[0]}"] .item-input`);
                            if (input) input.focus();
                        }, 100);
                    }
                }
            });
        }

        if (isMobile() && (mobileMenuIndex !== -1 || mobileMenuSubIndex !== -1)) {
            document.querySelectorAll('.mobile-item-menu').forEach(menu => menu.remove());
            const navButtons = document.querySelector('.navigation-buttons');
            const menu = document.createElement('div');
            menu.className = 'mobile-item-menu';
            if (mobileMenuSubIndex !== -1) {
                // Sub-item menu
                menu.innerHTML = `
                <button class="control-button edit-button" onclick="editItem(${mobileMenuIndex}, '${containerId}', ${mobileMenuSubIndex}); hideMobileMenu()" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å"></button>
                <button class="control-button delete-button" onclick="deleteItem(${mobileMenuIndex}, '${containerId}', ${mobileMenuSubIndex}); hideMobileMenu()" title="–£–¥–∞–ª–∏—Ç—å"></button>
                <button class="control-button close-button" onclick="hideMobileMenu()" title="–°–∫—Ä—ã—Ç—å"></button>
            `;
            } else {
                // Top-level item menu
                menu.innerHTML = `
                <button class="control-button edit-button" onclick="editItem(${mobileMenuIndex}, '${containerId}'); hideMobileMenu()" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å"></button>
                ${isTopics ? `
                    <button class="control-button add-sub-button" onclick="addSubItem(${mobileMenuIndex}, '${containerId}'); hideMobileMenu()" title="–î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥—Ä–∞–∑–¥–µ–ª"></button>
                ` : ''}
                ${!isTopics ? `
                    <button class="control-button drag-button" onmousedown="startDrag(event, ${mobileMenuIndex}, '${containerId}')" title="–ü–µ—Ä–µ—Ç–∞—â–∏—Ç—å"></button>
                ` : ''}
                <button class="control-button delete-button" onclick="deleteItem(${mobileMenuIndex}, '${containerId}'); hideMobileMenu()" title="–£–¥–∞–ª–∏—Ç—å"></button>
                <button class="control-button close-button" onclick="hideMobileMenu()" title="–°–∫—Ä—ã—Ç—å"></button>
            `;
            }
            navButtons.parentNode.insertBefore(menu, navButtons);
        }

        if (lastDeleted[containerId]) {
            document.querySelectorAll('.popup').forEach(popup => popup.remove());
            const popup = document.createElement('div');
            popup.className = 'popup';
            popup.innerHTML = `–≠–ª–µ–º–µ–Ω—Ç —É–¥–∞–ª—ë–Ω, –Ω–∞–∂–º–∏ —Ç—É—Ç –¥–ª—è –æ—Ç–º–µ–Ω—ã`;
            popup.onclick = () => undoDelete(containerId);
            document.body.appendChild(popup);
            setTimeout(() => {
                popup.remove();
                lastDeleted[containerId] = null;
                lastDeletedIndex[containerId] = null;
            }, 5000);
        }
    }

    function handleItemClick(index, containerId, subIndex = null) {
        if (isMobile()) {
            mobileMenuIndex = index;
            mobileMenuSubIndex = subIndex !== null ? subIndex : -1;
            renderList(containerId);
        } else {
            editItem(index, containerId, subIndex);
        }
    }

    function hideMobileMenu() {
        mobileMenuIndex = -1;
        mobileMenuSubIndex = -1;
        document.querySelectorAll('.mobile-item-menu').forEach(menu => menu.remove());
        renderList('listContainer');
        renderList('topicsContainer');
    }

    function addNewItem(containerId) {
        items[containerId] = items[containerId].filter(item => !item.editing);
        items[containerId].unshift({
            text: '',
            editing: true,
            originalText: '',
            subItems: containerId === 'topicsContainer' ? [] : null
        });
        document.querySelectorAll('.popup').forEach(popup => popup.remove());
        const popup = document.createElement('div');
        popup.className = 'popup';
        popup.innerHTML = `–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—ã–π —Ç–µ–∫—Å—Ç. –ü–æ—Å–ª–µ –≤–≤–æ–¥–∞ —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ.`;
        document.body.appendChild(popup);
        setTimeout(() => {
            popup.remove();
        }, 5000);
        hideMobileMenu();
        renderList(containerId);
    }

    function addSubItem(index, containerId) {
        if (containerId !== 'topicsContainer') return;
        items[containerId][index].subItems = items[containerId][index].subItems || [];
        items[containerId][index].subItems.unshift({text: '', editing: true, originalText: ''});
        hideMobileMenu();
        renderList(containerId);
    }

    function editItem(index, containerId, subIndex = null) {
        items[containerId] = items[containerId].filter(item => !item.editing);
        if (subIndex !== null) {
            items[containerId][index].subItems = items[containerId][index].subItems.map(subItem => ({
                ...subItem,
                editing: false
            }));
            items[containerId][index].subItems[subIndex].originalText = items[containerId][index].subItems[subIndex].text;
            items[containerId][index].subItems[subIndex].editing = true;
        } else {
            items[containerId][index].originalText = items[containerId][index].text;
            items[containerId][index].editing = true;
        }
        renderList(containerId);
    }

    function finishEditing(index, containerId, subIndex = null) {
        const selector = subIndex !== null
            ? `[data-index="${index}"][data-sub-index="${subIndex}"] .item-input`
            : `[data-index="${index}"] .item-input`;
        const input = document.querySelector(selector);
        if (input) {
            if (subIndex !== null) {
                items[containerId][index].subItems[subIndex].text = input.value;
                items[containerId][index].subItems[subIndex].editing = false;
                items[containerId][index].subItems[subIndex].originalText = null;
            } else {
                items[containerId][index].text = input.value;
                items[containerId][index].editing = false;
                items[containerId][index].originalText = null;
            }
            hideMobileMenu();
            renderList(containerId);
        }
    }

    function handleKeyPress(event, index, containerId, subIndex = null) {
        if (event.key === 'Enter') {
            finishEditing(index, containerId, subIndex);
        }
    }

    function cancelEditing(index, containerId, subIndex = null) {
        if (subIndex !== null) {
            if (items[containerId][index].subItems[subIndex].originalText !== null) {
                items[containerId][index].subItems[subIndex].text = items[containerId][index].subItems[subIndex].originalText;
            }
            items[containerId][index].subItems[subIndex].editing = false;
            items[containerId][index].subItems[subIndex].originalText = null;
        } else {
            if (items[containerId][index].originalText !== null) {
                items[containerId][index].text = items[containerId][index].originalText;
            }
            items[containerId][index].editing = false;
            items[containerId][index].originalText = null;
        }
        hideMobileMenu();
        renderList(containerId);
    }

    function deleteItem(index, containerId, subIndex = null) {
        const selector = subIndex !== null
            ? `[data-index="${index}"][data-sub-index="${subIndex}"]`
            : `[data-index="${index}"]`;
        const itemElement = document.querySelector(selector);
        itemElement.classList.add('removing');
        if (subIndex !== null) {
            lastDeleted[containerId] = items[containerId][index].subItems[subIndex];
            lastDeletedIndex[containerId] = {index, subIndex};
            setTimeout(() => {
                items[containerId][index].subItems.splice(subIndex, 1);
                hideMobileMenu();
                renderList(containerId);
            }, 300);
        } else {
            lastDeleted[containerId] = items[containerId][index];
            lastDeletedIndex[containerId] = {index};
            setTimeout(() => {
                items[containerId].splice(index, 1);
                hideMobileMenu();
                renderList(containerId);
            }, 300);
        }
    }

    function undoDelete(containerId) {
        if (lastDeleted[containerId] && lastDeletedIndex[containerId] !== null) {
            const {index, subIndex} = lastDeletedIndex[containerId];
            if (subIndex !== undefined) {
                items[containerId][index].subItems.splice(subIndex, 0, lastDeleted[containerId]);
            } else {
                items[containerId].splice(index, 0, lastDeleted[containerId]);
            }
            lastDeleted[containerId] = null;
            lastDeletedIndex[containerId] = null;
            hideMobileMenu();
            renderList(containerId);
        }
    }

    function startDrag(event, index, containerId) {
        if (containerId === 'topicsContainer') return;
        event.preventDefault();
        const itemElement = document.querySelector(`[data-index="${index}"]`);
        draggedElement = itemElement;
        draggedIndex = index;

        itemElement.style.cursor = 'grabbing';

        function onMouseMove(e) {
            if (!draggedElement) return;

            draggedElement.classList.add('dragging');
            draggedElement.style.position = 'fixed';
            draggedElement.style.left = e.clientX - draggedElement.offsetWidth / 2 + 'px';
            draggedElement.style.top = e.clientY - 20 + 'px';
            draggedElement.style.zIndex = '1000';
            draggedElement.style.pointerEvents = 'none';

            const elements = document.elementsFromPoint(e.clientX, e.clientY);
            const targetItem = elements.find(el => el.classList.contains('list-item') && !el.classList.contains('dragging'));

            document.querySelectorAll('.drag-over').forEach(el => el.classList.remove('drag-over'));

            if (targetItem) {
                targetItem.classList.add('drag-over');
            }
        }

        function onMouseUp(e) {
            document.removeEventListener('mousemove', onMouseMove);
            document.removeEventListener('mouseup', onMouseUp);

            if (!draggedElement) return;

            const elements = document.elementsFromPoint(e.clientX, e.clientY);
            const targetItem = elements.find(el => el.classList.contains('list-item') && !el.classList.contains('dragging'));

            if (targetItem) {
                const targetIndex = parseInt(targetItem.dataset.index);
                if (targetIndex !== draggedIndex) {
                    const draggedItem = items[containerId][draggedIndex];
                    items[containerId].splice(draggedIndex, 1);
                    items[containerId].splice(targetIndex, 0, draggedItem);
                }
            }

            draggedElement.style.position = '';
            draggedElement.style.left = '';
            draggedElement.style.top = '';
            draggedElement.style.zIndex = '';
            draggedElement.style.pointerEvents = '';
            draggedElement.style.cursor = '';
            draggedElement.classList.remove('dragging');

            document.querySelectorAll('.drag-over').forEach(el => el.classList.remove('drag-over'));

            draggedElement = null;
            draggedIndex = -1;
            hideMobileMenu();
            renderList(containerId);
        }

        document.addEventListener('mousemove', onMouseMove);
        document.addEventListener('mouseup', onMouseUp);
    }

    // Theme selection
    document.querySelectorAll('.theme-block').forEach((item) => {
        item.addEventListener('click', () => {
            document.querySelectorAll('.theme-block').forEach(block => block.classList.remove('active'));
            item.classList.add('active');
        });
    });

    // Desktop steps
    document.querySelectorAll('.step-item').forEach((item) => {
        item.addEventListener('click', () => {
            document.querySelectorAll('.step-item').forEach(step => step.classList.remove('active'));
            item.classList.add('active');
        });
    });

    // Mobile steps
    document.querySelectorAll('.mobile-step-item').forEach((item) => {
        item.addEventListener('click', () => {
            document.querySelectorAll('.mobile-step-item').forEach(step => step.classList.remove('active'));
            item.classList.add('active');
        });
    });

    // Navigation buttons
    document.querySelector('.nav-button.next').addEventListener('click', () => {
        console.log('–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥');
    });

    document.querySelector('.nav-button.back').addEventListener('click', () => {
        console.log('–ü—Ä–µ–¥—ã–¥—É—â–∏–π —à–∞–≥');
    });

    // List and Topics management
    let items = {listContainer: [], topicsContainer: []};
    let draggedElement = null;
    let draggedIndex = -1;
    let lastDeleted = {listContainer: null, topicsContainer: null};
    let lastDeletedIndex = {listContainer: null, topicsContainer: null};
    let mobileMenuIndex = -1;
    let mobileMenuSubIndex = -1;

    // Volume component
    const sections = [
        {name: '–¢–∏—Ç—É–ª—å–Ω–∏–∫', color: '#E7E7E9', size: 1},
        {name: '–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ', color: '#D4FBE6', size: 1},
        {name: '–¢–µ–∫—Å—Ç —Ä–∞–±–æ—Ç—ã', color: '#EFDFF7', size: 10},
        {name: '–õ–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞', color: '#D3FAF8', size: 1}
    ];

    function updateBar() {
        const visualSizes = sections.map((sec, index) => index === 2 ? sec.size : sec.size * 3);
        const total = visualSizes.reduce((sum, size) => sum + size, 0);
        const bar = document.getElementById('volumeBar');
        const labels = document.getElementById('volumeLabels');
        bar.innerHTML = sections.map((sec, index) => `
            <div class="section" style="width: ${(visualSizes[index] / total * 100).toFixed(2)}%; background-color: ${sec.color};">
                <span class="section-size">${sec.size}</span>
            </div>
        `).join('');
        labels.innerHTML = sections.map((sec, index) => `
            <span class="section-label" style="flex: 0 0 ${(visualSizes[index] / total * 100).toFixed(2)}%;">${sec.name}</span>
        `).join('');
    }

    const textInput = document.getElementById('textPages');
    textInput.addEventListener('input', () => {
        let value = parseInt(textInput.value);
        if (isNaN(value) || value < 1) value = 1;
        sections[2].size = value;
        textInput.value = value;
        updateBar();
    });

    document.getElementById('decrement').addEventListener('click', () => {
        textInput.value = Math.max(1, parseInt(textInput.value) - 1);
        textInput.dispatchEvent(new Event('input'));
    });

    document.getElementById('increment').addEventListener('click', () => {
        textInput.value = parseInt(textInput.value) + 1;
        textInput.dispatchEvent(new Event('input'));
    });

    // Initialize
    renderList('listContainer');
    renderList('topicsContainer');
    updateBar();
</script>
</body>
</html>